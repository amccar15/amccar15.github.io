{"ast":null,"code":"import _regeneratorRuntime from\"/Users/macuser/Documents/amccar15.github.io/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/macuser/Documents/amccar15.github.io/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/macuser/Documents/amccar15.github.io/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useParams}from\"react-router-dom\";import React,{useEffect,useState}from\"react\";import{auth,db}from'../firebase-config';import{collection,doc,getDoc,updateDoc}from'firebase/firestore';import{getStorage,ref,uploadBytesResumable,getDownloadURL}from'firebase/storage';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function ThePost(_ref){var isAuth=_ref.isAuth;var _useParams=useParams(),id=_useParams.id;var postsCollectionRef=collection(db,\"posts\");var _useState=useState([]),_useState2=_slicedToArray(_useState,2),docDetails=_useState2[0],setDocDetails=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),seeAuthorName=_useState4[0],setAuthorName=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),seeAuthorID=_useState6[0],setAuthorID=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),image=_useState8[0],setImage=_useState8[1];var storage=getStorage();var onImageChange=function onImageChange(e){var reader=new FileReader();var file=e.target.files[0];if(file){reader.onload=function(){if(reader.readyState===2){console.log(file);setImage(file);}};reader.readAsDataURL(e.target.files[0]);}else{setImage(null);}};var uploadPhoto=function uploadPhoto(){if(image!=null){var storageRef=ref(storage,\"image/\"+id);var uploadTask=uploadBytesResumable(storageRef,image);uploadTask.on('state_changed',function(snapshot){var progress=snapshot.bytesTransferred/snapshot.totalBytes*100;console.log(\"Upload is: \"+progress+\"% done\");switch(snapshot.state){case'paused':console.log(\"Upload is paused\");break;case'running':console.log('Upload is running');break;}},function(error){alert(\"Image upload failed\");console.log(error);},function(){getDownloadURL(uploadTask.snapshot.ref).then(function(downloadURL){console.log('File link at :',downloadURL);var postDoc=doc(postsCollectionRef,id);updateDoc(postDoc,{imageExist:downloadURL});getPost(id);});});}};useEffect(function(){getPost(id);},[]);var getPost=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(postID){var postDoc,docSnap;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:postDoc=doc(postsCollectionRef,postID);_context.next=3;return getDoc(postDoc);case 3:docSnap=_context.sent;setDocDetails(docSnap.data());if(docSnap.exists()){setAuthorName(docSnap.data().author.name);setAuthorID(docSnap.data().author.id);}else{console.log(\"Error\");}case 6:case\"end\":return _context.stop();}}},_callee);}));return function getPost(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"thePost\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"postHeader\",children:[isAuth&&seeAuthorID===auth.currentUser.uid&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/x-png, image/jpeg\",onChange:function onChange(e){return onImageChange(e);}}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return uploadPhoto();},children:\"Add Image\"})]}),docDetails.imageExist!==''&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"img\",{className:\"headerImg\",src:docDetails.imageExist}),/*#__PURE__*/_jsx(\"div\",{className:\"postHeadContainer\",children:/*#__PURE__*/_jsxs(\"h1\",{className:\"postHeadTitle\",children:[\" \",docDetails.title,\" \"]})})]}),docDetails.imageExist===''&&/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"h1\",{className:\"noPhotoTitle\",children:docDetails.title})})]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"postTextContainer\",children:[\" \",docDetails.postText,\" \"]}),/*#__PURE__*/_jsxs(\"h3\",{children:[\"@\",seeAuthorName]})]});}export default ThePost;","map":{"version":3,"names":["useParams","React","useEffect","useState","auth","db","collection","doc","getDoc","updateDoc","getStorage","ref","uploadBytesResumable","getDownloadURL","ThePost","isAuth","id","postsCollectionRef","docDetails","setDocDetails","seeAuthorName","setAuthorName","seeAuthorID","setAuthorID","image","setImage","storage","onImageChange","e","reader","FileReader","file","target","files","onload","readyState","console","log","readAsDataURL","uploadPhoto","storageRef","uploadTask","on","snapshot","progress","bytesTransferred","totalBytes","state","error","alert","then","downloadURL","postDoc","imageExist","getPost","postID","docSnap","data","exists","author","name","currentUser","uid","title","postText"],"sources":["/Users/macuser/Documents/amccar15.github.io/src/pages/ThePost.js"],"sourcesContent":["import { useParams } from \"react-router-dom\";\nimport React, { useEffect, useState } from \"react\";\nimport { auth, db } from '../firebase-config';\nimport { collection, doc, getDoc, updateDoc } from 'firebase/firestore';\nimport { getStorage, ref, uploadBytesResumable, getDownloadURL } from 'firebase/storage';\n\nfunction ThePost({ isAuth }) {\n\n    const { id } = useParams();\n\n    const postsCollectionRef = collection(db, \"posts\");\n\n    const [docDetails, setDocDetails] = useState([]);\n\n    const [seeAuthorName, setAuthorName] = useState([]);\n\n    const [seeAuthorID, setAuthorID] = useState([]);\n\n    const [image, setImage] = useState(null);\n\n    const storage = getStorage();\n\n    const onImageChange = (e) => {\n        const reader = new FileReader();\n        let file = e.target.files[0];\n\n        if (file) {\n            reader.onload = () => {\n                if(reader.readyState === 2) {\n                    console.log(file);\n                    setImage(file);\n                }\n            };\n            reader.readAsDataURL(e.target.files[0]);\n        }\n        else {\n            setImage(null);\n        }\n    }\n\n    const uploadPhoto = () => {\n        if(image != null) {\n            const storageRef = ref(storage, \"image/\"+id);\n\n            const uploadTask = uploadBytesResumable(storageRef, image);\n\n            uploadTask.on('state_changed', (snapshot) => {\n                const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\n                console.log(\"Upload is: \" + progress + \"% done\");\n                switch (snapshot.state) {\n                    case 'paused':\n                        console.log(\"Upload is paused\");\n                        break;\n                    case 'running':\n                        console.log('Upload is running');\n                        break;\n                }\n            }, (error) => {\n                alert(\"Image upload failed\");\n                console.log(error);\n            }, () => {\n                getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {\n                    console.log('File link at :', downloadURL);\n                    const postDoc = doc(postsCollectionRef, id);\n                    updateDoc(postDoc, {\n                        imageExist: downloadURL,\n                    });\n                    getPost(id);\n                });\n            })\n        }\n    }\n\n    useEffect(() => {\n        getPost(id);\n    }, []);\n\n    const getPost = async (postID) => {\n        const postDoc = doc(postsCollectionRef, postID);\n        const docSnap = await getDoc(postDoc);\n        setDocDetails(docSnap.data());\n\n        if(docSnap.exists()) {\n            setAuthorName(docSnap.data().author.name);                \n            setAuthorID(docSnap.data().author.id);\n        } else {\n            console.log(\"Error\");\n        }        \n    };\n\n    return (\n        <div className=\"thePost\"> \n            <div className=\"postHeader\">\n                {isAuth && seeAuthorID === auth.currentUser.uid && (\n                    <div>\n                        <input type=\"file\" accept=\"image/x-png, image/jpeg\" onChange={(e) => onImageChange(e)}/>\n                        <button onClick={() => uploadPhoto()}>\n                            Add Image\n                        </button>\n                    </div>\n                )}\n                {docDetails.imageExist !== '' && (\n                    <div>\n                        <img className=\"headerImg\" src={docDetails.imageExist} />\n                        <div className=\"postHeadContainer\">\n                            <h1 className=\"postHeadTitle\"> {docDetails.title} </h1>\n                        </div>\n                    </div>\n                )}\n                {docDetails.imageExist === '' && (\n                    <div>\n                        <h1 className=\"noPhotoTitle\">{docDetails.title}</h1>\n                    </div>\n                )}\n            </div>\n            <hr />\n            <div className=\"postTextContainer\"> {docDetails.postText} </div>\n                <h3> \n                    @{seeAuthorName}\n                </h3>\n            </div>\n    );\n}\n\nexport default ThePost;"],"mappings":"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"},"metadata":{},"sourceType":"module"}